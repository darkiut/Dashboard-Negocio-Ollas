<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Inventario de Ollas - Panel</title>
  <link rel="stylesheet" href="css/style.css">
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
</head>

<body class="dashboard-body">
  <!-- Mobile Toggle -->
  <button id="menuToggle" class="menu-toggle" onclick="toggleSidebar()">â˜°</button>

  <!-- SIDEBAR -->
  <div class="sidebar" id="sidebar">
    <div class="logo">
      <h2>GestiÃ³n Ollas</h2>
    </div>
    <nav>
      <ul>
        <li><a href="#" class="active" onclick="showSection('productos')">ğŸ“¦ Productos</a></li>
        <li><a href="#" onclick="showSection('ventas')">ğŸ’° Ventas</a></li>
      </ul>
    </nav>
    <div class="user-info">
      <span id="userEmail">Usuario</span>
      <button onclick="logout()" class="btn-logout">Cerrar SesiÃ³n</button>
    </div>
  </div>

  <!-- MAIN CONTENT -->
  <div class="main-content">

    <!-- ==================== PRODUCTOS SECTION ==================== -->
    <div id="productosSection" class="section">
      <div class="header">
        <h1>Inventario de Productos</h1>
        <button class="btn-primary" onclick="abrirModalProducto()">+ Nuevo Producto</button>
      </div>

      <!-- MÃ‰TRICAS -->
      <!-- MÃ‰TRICAS PROFESIONALES -->
      <div class="metrics-grid">
        <div class="metric-card">
          <div style="font-size: 0.8125rem; color: var(--text-secondary); font-weight: 600; margin-bottom: 0.5rem;">TOTAL
            VENDIDO HOY</div>
          <div id="metricTotalHoy" style="font-size: 2rem; font-weight: 700; color: var(--primary);">S/ 0.00</div>
        </div>
      
        <div class="metric-card">
          <div style="font-size: 0.8125rem; color: var(--text-secondary); font-weight: 600; margin-bottom: 0.5rem;">VENTAS DEL
            MES</div>
          <div id="metricVentasMes" style="font-size: 2rem; font-weight: 700; color: var(--success);">0</div>
        </div>
      
        <div class="metric-card">
          <div style="font-size: 0.8125rem; color: var(--text-secondary); font-weight: 600; margin-bottom: 0.5rem;">PRODUCTOS
            STOCK BAJO</div>
          <div id="metricStockBajo" style="font-size: 2rem; font-weight: 700; color: var(--warning);">0</div>
        </div>
      
        <div class="metric-card">
          <div style="font-size: 0.8125rem; color: var(--text-secondary); font-weight: 600; margin-bottom: 0.5rem;">TOTAL
            PRODUCTOS</div>
          <div id="metricTotalProductos" style="font-size: 2rem; font-weight: 700; color: var(--info);">0</div>
        </div>
      </div>


      <!-- FILTROS -->
      <div class="filters">
        <div class="filter-group" style="flex: 1;">
          <label for="searchProduct">ğŸ” Buscar</label>
          <input type="text" id="searchProduct" placeholder="Buscar por nombre o categorÃ­a..."
            onkeyup="filterProductos()">
        </div>
      </div>

      <!-- TABLA DE PRODUCTOS -->
      <div class="card">
        <div class="table-responsive scrollable" style="max-height: 500px; overflow-y: auto;">
          <table id="productosTable">
            <thead>
              <tr>
                <th>Nombre</th>
                <th>CÃ³digo</th>
                <th>Stock</th>
                <th>Precio</th>
                <th>CategorÃ­a</th>
                <th>Acciones</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td colspan="6" style="text-align: center; padding: 2rem;">
                  <div style="display: inline-block;">
                    <div style="font-size: 3rem; margin-bottom: 0.5rem;">â³</div>
                    <div>Cargando productos...</div>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

    </div>

    <!-- ==================== VENTAS SECTION ==================== -->
    <div id="ventasSection" class="section" style="display: none;">
      <div class="header">
        <h1>Registro de Ventas</h1>
        <button class="btn-primary" onclick="exportarReporteDiario()"
          style="background: linear-gradient(135deg, #10b981, #059669);">
          ğŸ“¥ Reporte Excel
        </button>
      </div>

      <!-- TOTAL DEL DÃA -->
      <div class="card"
        style="margin-bottom: 1.5rem; text-align: center; background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%); border-left: 5px solid #2563eb; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
        <h3 style="color: #1e40af; margin-bottom: 0.5rem;">ğŸ’µ Total Vendido Hoy</h3>
        <h1 id="totalVentasDiaDisplay" style="color: #1e40af; font-size: 2.5rem; margin: 0;">S/ 0.00</h1>
      </div>

      <!-- FILTROS -->
      <div class="filters">
        <div class="filter-group">
          <label for="filterDate">ğŸ“… Fecha</label>
          <input type="date" id="filterDate" onchange="filterVentas()">
        </div>
        <div class="filter-group">
          <label for="filterSeller">ğŸ‘¤ Vendedor</label>
          <input type="text" id="filterSeller" placeholder="Nombre vendedor" onkeyup="filterVentas()">
        </div>
      </div>

      <!-- TABLA DE VENTAS -->
      <div class="card">
        <div class="table-responsive scrollable" style="max-height: 500px; overflow-y: auto;">
          <table id="ventasTable">
            <thead>
              <tr>
                <th>Fecha</th>
                <th>Cliente</th>
                <th>Vendedor</th>
                <th>Total</th>
                <th>Acciones</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td colspan="5" style="text-align: center; padding: 2rem;">
                  <div style="display: inline-block;">
                    <div style="font-size: 3rem; margin-bottom: 0.5rem;">â³</div>
                    <div>Cargando ventas...</div>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

    </div>

  </div>

  <!-- ==================== ÃREA DE IMPRESIÃ“N ==================== -->
  <div id="printableArea"></div>

  <!-- ==================== MODALS ==================== -->

  <!-- Modal: Picking (Detalle AlmacÃ©n) -->
  <div id="pickingModal" class="modal">
    <div class="modal-content">
      <span class="close-modal" onclick="cerrarModal('pickingModal')">&times;</span>
      <h2>ğŸ“‹ Detalle de Picking (AlmacÃ©n)</h2>
      <div id="pickingContent"></div>
      <button class="btn-primary" onclick="cerrarModal('pickingModal')" style="margin-top: 1rem;">Cerrar</button>
    </div>
  </div>

  <!-- Modal: Nuevo Producto -->
  <div id="productoModal" class="modal">
    <div class="modal-content">
      <span class="close-modal" onclick="cerrarModal('productoModal')">&times;</span>
      <h2>â• Nuevo Producto</h2>
      <form id="productoForm" onsubmit="guardarNuevoProducto(event)">
        <div class="form-group">
          <label>Nombre:</label>
          <input type="text" id="prodNombre" required placeholder="Ej: Olla NÂ° 24">
        </div>
        <div class="form-group">
          <label>CÃ³digo:</label>
          <input type="text" id="prodCodigo" required placeholder="Ej: OLL-024">
        </div>
        <div class="form-group">
          <label>CategorÃ­a:</label>
          <input type="text" id="prodCategoria" required placeholder="Ej: Ollas">
        </div>
        <div class="form-group">
          <label>Precio Unitario (S/):</label>
          <input type="number" step="0.01" id="prodPrecio" required placeholder="0.00">
        </div>
        <div class="form-group">
          <label>Stock Inicial:</label>
          <input type="number" id="prodStock" required placeholder="0">
        </div>
        <button type="submit" class="btn-primary">ğŸ’¾ Guardar Producto</button>
      </form>
    </div>
  </div>

  <!-- Modal: Editar Producto -->
  <div id="editarModal" class="modal">
    <div class="modal-content">
      <span class="close-modal" onclick="cerrarModal('editarModal')">&times;</span>
      <h2>âœï¸ Editar Producto</h2>
      <input type="hidden" id="editId">
      <div class="form-group">
        <label>Nombre:</label>
        <input type="text" id="editNombre" required>
      </div>
      <div class="form-group">
        <label>Precio Unitario (S/):</label>
        <input type="number" step="0.01" id="editPrecio" required>
      </div>
      <div class="form-group">
        <label>Stock:</label>
        <input type="number" id="editStock" required>
      </div>
      <button class="btn-primary" onclick="guardarEdicionProducto()">ğŸ’¾ Guardar Cambios</button>
    </div>
  </div>

  <!-- Modal: Ajuste de Stock -->
  <div id="stockModal" class="modal">
    <div class="modal-content">
      <span class="close-modal" onclick="cerrarModal('stockModal')">&times;</span>
      <h2>ğŸ“Š Ajuste de Stock</h2>
      <h3 id="stockProdName" style="color: var(--primary); margin-bottom: 1rem;"></h3>
      <div style="background: var(--bg-main); padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
        <p style="margin: 0;">Stock Actual: <strong id="stockActualDisplay"
            style="font-size: 1.5rem; color: var(--primary);"></strong></p>
      </div>
      <input type="hidden" id="stockId">
      <div class="form-group">
        <label>Cantidad a ajustar:</label>
        <input type="number" id="stockCantidad" min="1" value="1">
      </div>
      <div style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;">
        <button class="btn-primary" style="background: linear-gradient(135deg, #2563eb, #3b82f6);"
          onclick="aplicarStock(1)">
          â• Ingreso
        </button>
        <button class="btn-primary" style="background: linear-gradient(135deg, #ef4444, #dc2626);"
          onclick="aplicarStock(-1)">
          â– Salida / PÃ©rdida
        </button>
      </div>
    </div>
  </div>

  <!-- Modal: Detalles de Venta -->
  <div id="detalleVentaModal" class="modal">
    <div class="modal-content" style="max-width: 700px;">
      <span class="close-modal" onclick="cerrarModal('detalleVentaModal')">&times;</span>
      <h2>ğŸ“„ Detalles de la Venta</h2>
      <div id="detalleVentaContent"></div>
      <div style="display: flex; gap: 1rem; justify-content: center; margin-top: 2rem; flex-wrap: wrap;">
        <button class="btn-primary" style="background: linear-gradient(135deg, #f59e0b, #d97706);"
          onclick="iniciarEdicionVenta()">
          âœï¸ Editar Venta
        </button>
        <button class="btn-primary" style="background: linear-gradient(135deg, #ef4444, #dc2626);"
          onclick="confirmarEliminarVenta()">
          ğŸ—‘ï¸ Eliminar Venta
        </button>
      </div>
    </div>
  </div>

  <!-- Modal: Editar Venta -->
  <div id="editarVentaModal" class="modal">
    <div class="modal-content" style="max-width: 800px;">
      <span class="close-modal" onclick="cerrarModal('editarVentaModal')">&times;</span>
      <h2>âœï¸ Editar Venta</h2>
      <div id="editarVentaContent"></div>
      <div style="display: flex; gap: 1rem; justify-content: center; margin-top: 2rem; flex-wrap: wrap;">
        <button class="btn-primary" onclick="guardarEdicionVenta()">ğŸ’¾ Guardar Cambios</button>
        <button class="btn-primary" style="background: #6b7280;"
          onclick="cerrarModal('editarVentaModal')">Cancelar</button>
      </div>
    </div>
  </div>

  <!-- Modal: Confirmar EliminaciÃ³n -->
  <div id="confirmarEliminarModal" class="modal">
    <div class="modal-content" style="max-width: 550px;">
      <span class="close-modal" onclick="cerrarModal('confirmarEliminarModal')">&times;</span>
      <div style="text-align: center;">
        <div style="font-size: 4rem; color: #ef4444;">âš ï¸</div>
        <h2 style="color: #ef4444; margin: 1rem 0;">Â¿Eliminar Venta?</h2>
        <p style="color: var(--text-secondary); margin-bottom: 1.5rem;">Esta acciÃ³n NO se puede deshacer.</p>
        <div id="stockReponerInfo"
          style="background: #fef3c7; padding: 1.5rem; border-radius: 12px; margin: 1.5rem 0; border-left: 4px solid #f59e0b;">
          <strong style="display: block; margin-bottom: 1rem; color: #92400e;">ğŸ“¦ Se repondrÃ¡ el siguiente
            stock:</strong>
          <div id="stockReponerLista" style="text-align: left; max-height: 200px; overflow-y: auto;"></div>
        </div>
        <div style="display: flex; gap: 1rem; justify-content: center; margin-top: 1.5rem; flex-wrap: wrap;">
          <button class="btn-primary" style="background: linear-gradient(135deg, #ef4444, #dc2626);"
            onclick="eliminarVenta()">
            ğŸ—‘ï¸ SÃ­, Eliminar
          </button>
          <button class="btn-primary" style="background: #6b7280;" onclick="cerrarModal('confirmarEliminarModal')">
            Cancelar
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- ==================== SCRIPTS ==================== -->

  <!-- SheetJS para Excel -->
  <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>

  <!-- App Logic -->
  <script src="js/app.js"></script>

  <!-- Initialization -->
  <script>
    // Auth check y inicializaciÃ³n
    window.onload = function () {
      checkAuth();
      initDashboard();
    }

    // Toggle sidebar en mÃ³vil
    function toggleSidebar() {
      const sidebar = document.getElementById('sidebar');
      sidebar.classList.toggle('active');

      if (sidebar.classList.contains('active')) {
        document.addEventListener('click', closeSidebarOnClickOutside);
      } else {
        document.removeEventListener('click', closeSidebarOnClickOutside);
      }
    }

    // Cerrar sidebar al hacer clic fuera
    function closeSidebarOnClickOutside(event) {
      const sidebar = document.getElementById('sidebar');
      const toggle = document.getElementById('menuToggle');

      if (!sidebar.contains(event.target) && !toggle.contains(event.target)) {
        sidebar.classList.remove('active');
        document.removeEventListener('click', closeSidebarOnClickOutside);
      }
    }

    // Mostrar secciÃ³n y actualizar navegaciÃ³n
    function showSection(sectionId) {
      // Ocultar todas las secciones
      document.querySelectorAll('.section').forEach(el => el.style.display = 'none');

      // Mostrar secciÃ³n seleccionada
      document.getElementById(sectionId + 'Section').style.display = 'block';

      // Actualizar clase active en navegaciÃ³n
      document.querySelectorAll('.sidebar nav a').forEach(el => el.classList.remove('active'));
      event.target.classList.add('active');

      // Cerrar sidebar en mÃ³vil
      if (window.innerWidth <= 768) {
        const sidebar = document.getElementById('sidebar');
        sidebar.classList.remove('active');
      }
    }
  </script>

</body>

</html>